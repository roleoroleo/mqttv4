/*
 * This file is part of libipc (https://github.com/TheCrypt0/libipc).
 * Copyright (c) 2019 Davide Maggioni.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, version 3.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

#ifndef IPC_H
#define IPC_H

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <stdarg.h>
#include <string.h>
#include <fcntl.h>
#include <errno.h>
#include <pthread.h>
#include <mqueue.h>

#define IPC_LIBRARY_VERSION     "0.1.0"

#define IPC_DEBUG               0

#define IPC_QUEUE_NAME          "/ipc_dispatch_1"
#define IPC_MESSAGE_MAX_SIZE    512

// IPC events
#define IPC_MOTION_START                "\x01\x00\x00\x00\x02\x00\x00\x00\x7c\x00\x7c\x00\x00\x00\x00\x00"
#define IPC_MOTION_START_C              "\x04\x00\x00\x00\x02\x00\x00\x00\x09\x70\x09\x70\x00\x00\x00\x00"
#define IPC_MOTION_STOP                 "\x01\x00\x00\x00\x02\x00\x00\x00\x7d\x00\x7d\x00\x00\x00\x00\x00"
#define IPC_AI_HUMAN_DETECTION          "\x01\x00\x00\x00\x02\x00\x00\x00\xed\x00\xed\x00\x00\x00\x00\x00"
#define IPC_AI_BODY_DETECTION_C         "\x04\x00\x00\x00\x02\x00\x00\x00\x06\x70\x06\x70\x00\x00\x00\x00"
#define IPC_AI_VEHICLE_DETECTION_C      "\x04\x00\x00\x00\x02\x00\x00\x00\x07\x70\x07\x70\x00\x00\x00\x00"
#define IPC_AI_ANIMAL_DETECTION_C       "\x04\x00\x00\x00\x02\x00\x00\x00\x08\x70\x08\x70\x00\x00\x00\x00"
#define IPC_BABY_CRYING                 "\x04\x00\x00\x00\x02\x00\x00\x00\x02\x60\x02\x60\x00\x00\x00\x00"
#define IPC_SOUND_DETECTION             "\x04\x00\x00\x00\x02\x00\x00\x00\x04\x60\x04\x60\x00\x00\x00\x00"

// IPC commands
#define IPC_SWITCH_OFF                  "\x02\x00\x00\x00\x08\x00\x00\x00\x75\x00\x01\x00\x00\x00\x00\x00"
#define IPC_SWITCH_ON                   "\x02\x00\x00\x00\x08\x00\x00\x00\x74\x00\x01\x00\x00\x00\x00\x00"
#define IPC_SAVE_ALWAYS                 "\x02\x00\x00\x00\x08\x00\x00\x00\x79\x00\x01\x00\x00\x00\x00\x00"
#define IPC_SAVE_DETECT                 "\x02\x00\x00\x00\x08\x00\x00\x00\x78\x00\x01\x00\x00\x00\x00\x00"
#define IPC_AI_MOTION_DETECTION_OFF     "\x01\x00\x00\x00\x08\x00\x00\x00\x41\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_AI_MOTION_DETECTION_ON      "\x01\x00\x00\x00\x08\x00\x00\x00\x41\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_SENS_HIGH                   "\x01\x00\x00\x00\x08\x00\x00\x00\x27\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_SENS_MEDIUM                 "\x01\x00\x00\x00\x08\x00\x00\x00\x27\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_SENS_LOW                    "\x01\x00\x00\x00\x08\x00\x00\x00\x27\x10\x01\x00\x04\x00\x00\x00\x02\x00\x00\x00"
#define IPC_AI_HUMAN_DETECTION_OFF      "\x01\x00\x00\x00\x08\x00\x00\x00\x3c\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_AI_HUMAN_DETECTION_ON       "\x01\x00\x00\x00\x08\x00\x00\x00\x3c\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_AI_VEHICLE_DETECTION_OFF    "\x01\x00\x00\x00\x08\x00\x00\x00\x40\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_AI_VEHICLE_DETECTION_ON     "\x01\x00\x00\x00\x08\x00\x00\x00\x40\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_AI_ANIMAL_DETECTION_OFF     "\x01\x00\x00\x00\x08\x00\x00\x00\x3f\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_AI_ANIMAL_DETECTION_ON      "\x01\x00\x00\x00\x08\x00\x00\x00\x3f\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_FACE_DETECTION_OFF          "\x01\x00\x00\x00\x08\x00\x00\x00\x3d\x10\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_FACE_DETECTION_ON           "\x01\x00\x00\x00\x08\x00\x00\x00\x3d\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_MOTION_TRACKING_OFF         "\x01\x00\x00\x00\x08\x00\x00\x00\x0b\x40\x01\x00\x04\x00\x00\x00\x00\x00\x00\x00"
#define IPC_MOTION_TRACKING_ON          "\x01\x00\x00\x00\x08\x00\x00\x00\x0b\x40\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_BABYCRYING_OFF              "\x02\x00\x00\x00\x08\x00\x00\x00\x29\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_BABYCRYING_ON               "\x02\x00\x00\x00\x08\x00\x00\x00\x29\x10\x01\x00\x04\x00\x00\x00\x02\x00\x00\x00"
#define IPC_SOUND_DETECTION_OFF         "\x02\x00\x00\x00\x08\x00\x00\x00\x3a\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_SOUND_DETECTION_ON          "\x02\x00\x00\x00\x08\x00\x00\x00\x3a\x10\x01\x00\x04\x00\x00\x00\x02\x00\x00\x00"
#define IPC_SOUND_SENS_30               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x1e\x00\x00\x00"
#define IPC_SOUND_SENS_35               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x23\x00\x00\x00"
#define IPC_SOUND_SENS_40               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x28\x00\x00\x00"
#define IPC_SOUND_SENS_45               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x2d\x00\x00\x00"
#define IPC_SOUND_SENS_50               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x32\x00\x00\x00"
#define IPC_SOUND_SENS_60               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x3c\x00\x00\x00"
#define IPC_SOUND_SENS_70               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x46\x00\x00\x00"
#define IPC_SOUND_SENS_80               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x50\x00\x00\x00"
#define IPC_SOUND_SENS_90               "\x02\x00\x00\x00\x08\x00\x00\x00\x3b\x10\x01\x00\x04\x00\x00\x00\x5a\x00\x00\x00"
#define IPC_LED_OFF                     "\x02\x00\x00\x00\x08\x00\x00\x00\x77\x00\x01\x00\x00\x00\x00\x00"
#define IPC_LED_ON                      "\x02\x00\x00\x00\x08\x00\x00\x00\x76\x00\x01\x00\x00\x00\x00\x00"
#define IPC_IR_OFF                      "\x02\x00\x00\x00\x08\x00\x00\x00\x24\x10\x01\x00\x04\x00\x00\x00\x02\x00\x00\x00"
#define IPC_IR_ON                       "\x02\x00\x00\x00\x08\x00\x00\x00\x24\x10\x01\x00\x04\x00\x00\x00\x01\x00\x00\x00"
#define IPC_ROTATE_OFF                  "\x02\x00\x00\x00\x08\x00\x00\x00\x7b\x00\x01\x00\x00\x00\x00\x00"
#define IPC_ROTATE_ON                   "\x02\x00\x00\x00\x08\x00\x00\x00\x7a\x00\x01\x00\x00\x00\x00\x00"
#define IPC_CRUISE_OFF                  "\x01\x00\x00\x00\x08\x00\x00\x00\x05\x40\x01\x00\x00\x00\x00\x00"
#define IPC_CRUISE_ON                   "\x01\x00\x00\x00\x08\x00\x00\x00\x04\x40\x01\x00\x00\x00\x00\x00"
#define IPC_CRUISE_PRESETS              "\x01\x00\x00\x00\x08\x00\x00\x00\x03\x40\x01\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
#define IPC_CRUISE_360                  "\x01\x00\x00\x00\x08\x00\x00\x00\x03\x40\x01\x00\x08\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00"

typedef enum
{
    IPC_MSG_UNRECOGNIZED,
    IPC_MSG_MOTION_START,
    IPC_MSG_MOTION_START_C,
    IPC_MSG_MOTION_STOP,
    IPC_MSG_AI_HUMAN_DETECTION,
    IPC_MSG_AI_VEHICLE_DETECTION,
    IPC_MSG_AI_ANIMAL_DETECTION,
    IPC_MSG_BABY_CRYING,
    IPC_MSG_SOUND_DETECTION,
    IPC_MSG_COMMAND,
    IPC_MSG_LAST
} IPC_MESSAGE_TYPE;

typedef enum
{
    IPC_CMD_SWITCH_OFF,
    IPC_CMD_SWITCH_ON,
    IPC_CMD_SAVE_ALWAYS,
    IPC_CMD_SAVE_DETECT,
    IPC_CMD_AI_MOTION_DETECTION_OFF,
    IPC_CMD_AI_MOTION_DETECTION_ON,
    IPC_CMD_SENS_HIGH,
    IPC_CMD_SENS_MEDIUM,
    IPC_CMD_SENS_LOW,
    IPC_CMD_AI_HUMAN_DETECTION_OFF,
    IPC_CMD_AI_HUMAN_DETECTION_ON,
    IPC_CMD_AI_VEHICLE_DETECTION_OFF,
    IPC_CMD_AI_VEHICLE_DETECTION_ON,
    IPC_CMD_AI_ANIMAL_DETECTION_OFF,
    IPC_CMD_AI_ANIMAL_DETECTION_ON,
    IPC_CMD_FACE_DETECTION_OFF,
    IPC_CMD_FACE_DETECTION_ON ,
    IPC_CMD_MOTION_TRACKING_OFF,
    IPC_CMD_MOTION_TRACKING_ON,
    IPC_CMD_BABYCRYING_OFF,
    IPC_CMD_BABYCRYING_ON,
    IPC_CMD_SOUND_DETECTION_OFF,
    IPC_CMD_SOUND_DETECTION_ON,
    IPC_CMD_SOUND_SENS_30,
    IPC_CMD_SOUND_SENS_35,
    IPC_CMD_SOUND_SENS_40,
    IPC_CMD_SOUND_SENS_45,
    IPC_CMD_SOUND_SENS_50,
    IPC_CMD_SOUND_SENS_60,
    IPC_CMD_SOUND_SENS_70,
    IPC_CMD_SOUND_SENS_80,
    IPC_CMD_SOUND_SENS_90,
    IPC_CMD_LED_OFF,
    IPC_CMD_LED_ON,
    IPC_CMD_IR_OFF,
    IPC_CMD_IR_ON ,
    IPC_CMD_ROTATE_OFF,
    IPC_CMD_ROTATE_ON,
    IPC_CMD_CRUISE_OFF,
    IPC_CMD_CRUISE_ON,
    IPC_CMD_CRUISE_PRESETS,
    IPC_CMD_CRUISE_360,
    IPC_CMD_LAST
} IPC_COMMAND_TYPE;

//-----------------------------------------------------------------------------
// INIT
//-----------------------------------------------------------------------------

int ipc_init();
void ipc_stop();

//-----------------------------------------------------------------------------
// GETTERS AND SETTERS
//-----------------------------------------------------------------------------

int ipc_set_callback(IPC_MESSAGE_TYPE type, void (*f)());


#endif // IPC_H
